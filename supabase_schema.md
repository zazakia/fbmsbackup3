-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.accounts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  type character varying NOT NULL CHECK (type::text = ANY (ARRAY['Asset'::character varying, 'Liability'::character varying, 'Equity'::character varying, 'Income'::character varying, 'Expense'::character varying]::text[])),
  description text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT accounts_pkey PRIMARY KEY (id)
);
CREATE TABLE public.categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  description text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT categories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.customers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  first_name character varying NOT NULL,
  last_name character varying NOT NULL,
  email character varying,
  phone character varying,
  address text,
  city character varying,
  state character varying,
  postal_code character varying,
  country character varying DEFAULT 'Philippines'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT customers_pkey PRIMARY KEY (id)
);
CREATE TABLE public.employees (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  employee_id character varying NOT NULL UNIQUE,
  first_name character varying NOT NULL,
  last_name character varying NOT NULL,
  middle_name character varying,
  email character varying NOT NULL,
  phone character varying NOT NULL,
  address text NOT NULL,
  city character varying NOT NULL,
  province character varying NOT NULL,
  zip_code character varying NOT NULL,
  birth_date timestamp with time zone NOT NULL,
  hire_date timestamp with time zone NOT NULL,
  position character varying NOT NULL,
  department character varying NOT NULL,
  employment_type character varying NOT NULL DEFAULT 'Regular'::character varying,
  status character varying NOT NULL DEFAULT 'Active'::character varying,
  basic_salary numeric NOT NULL DEFAULT 0,
  allowances jsonb DEFAULT '[]'::jsonb,
  sss_number character varying,
  philhealth_number character varying,
  pagibig_number character varying,
  tin_number character varying,
  bank_name character varying,
  bank_account_number character varying,
  emergency_contact jsonb NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT employees_pkey PRIMARY KEY (id)
);
CREATE TABLE public.expense_categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  description text,
  bir_classification character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT expense_categories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.expenses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  description character varying NOT NULL,
  category character varying NOT NULL,
  amount numeric NOT NULL DEFAULT 0,
  tax_amount numeric NOT NULL DEFAULT 0,
  total_amount numeric NOT NULL DEFAULT 0,
  date timestamp with time zone NOT NULL,
  vendor character varying,
  payment_method character varying,
  status character varying NOT NULL DEFAULT 'pending'::character varying,
  notes text,
  is_recurring boolean DEFAULT false,
  recurring_interval character varying,
  created_by uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT expenses_pkey PRIMARY KEY (id),
  CONSTRAINT expenses_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.inventory_locations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT inventory_locations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.journal_entries (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  date timestamp with time zone NOT NULL,
  reference character varying,
  description text,
  lines jsonb NOT NULL DEFAULT '[]'::jsonb,
  created_by uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT journal_entries_pkey PRIMARY KEY (id),
  CONSTRAINT journal_entries_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.leave_records (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  employee_id uuid NOT NULL,
  leave_type character varying NOT NULL,
  start_date timestamp with time zone NOT NULL,
  end_date timestamp with time zone NOT NULL,
  days numeric NOT NULL,
  reason text NOT NULL,
  status character varying NOT NULL DEFAULT 'Pending'::character varying,
  approved_by uuid,
  approved_date timestamp with time zone,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT leave_records_pkey PRIMARY KEY (id),
  CONSTRAINT leave_records_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(id),
  CONSTRAINT leave_records_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.employees(id)
);
CREATE TABLE public.payroll_entries (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  employee_id uuid NOT NULL,
  period_id uuid NOT NULL,
  basic_salary numeric NOT NULL DEFAULT 0,
  allowances numeric NOT NULL DEFAULT 0,
  gross_pay numeric NOT NULL DEFAULT 0,
  sss_contribution numeric NOT NULL DEFAULT 0,
  philhealth_contribution numeric NOT NULL DEFAULT 0,
  pagibig_contribution numeric NOT NULL DEFAULT 0,
  withholding_tax numeric NOT NULL DEFAULT 0,
  other_deductions numeric NOT NULL DEFAULT 0,
  total_deductions numeric NOT NULL DEFAULT 0,
  net_pay numeric NOT NULL DEFAULT 0,
  overtime_hours numeric NOT NULL DEFAULT 0,
  overtime_rate numeric NOT NULL DEFAULT 0,
  overtime_pay numeric NOT NULL DEFAULT 0,
  leave_days numeric NOT NULL DEFAULT 0,
  leave_pay numeric NOT NULL DEFAULT 0,
  thirteenth_month_pay numeric NOT NULL DEFAULT 0,
  status character varying NOT NULL DEFAULT 'Draft'::character varying,
  payment_date timestamp with time zone,
  payment_method character varying NOT NULL DEFAULT 'Bank Transfer'::character varying,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT payroll_entries_pkey PRIMARY KEY (id),
  CONSTRAINT payroll_entries_period_id_fkey FOREIGN KEY (period_id) REFERENCES public.payroll_periods(id),
  CONSTRAINT payroll_entries_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.employees(id)
);
CREATE TABLE public.payroll_periods (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  month integer NOT NULL,
  year integer NOT NULL,
  start_date timestamp with time zone NOT NULL,
  end_date timestamp with time zone NOT NULL,
  status character varying NOT NULL DEFAULT 'Open'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT payroll_periods_pkey PRIMARY KEY (id)
);
CREATE TABLE public.products (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  description text,
  sku character varying NOT NULL UNIQUE,
  barcode character varying,
  category character varying NOT NULL,
  price numeric NOT NULL DEFAULT 0,
  cost numeric NOT NULL DEFAULT 0,
  stock integer NOT NULL DEFAULT 0,
  min_stock integer NOT NULL DEFAULT 0,
  unit character varying NOT NULL DEFAULT 'piece'::character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT products_pkey PRIMARY KEY (id)
);
CREATE TABLE public.purchase_order_audit_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  purchase_order_id uuid NOT NULL,
  purchase_order_number text NOT NULL,
  action text NOT NULL,
  performed_by uuid,
  performed_by_name text,
  timestamp timestamp with time zone DEFAULT now(),
  old_values jsonb,
  new_values jsonb,
  reason text,
  metadata jsonb DEFAULT '{}'::jsonb,
  ip_address inet,
  user_agent text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT purchase_order_audit_logs_pkey PRIMARY KEY (id),
  CONSTRAINT purchase_order_audit_logs_performed_by_fkey FOREIGN KEY (performed_by) REFERENCES auth.users(id),
  CONSTRAINT purchase_order_audit_logs_purchase_order_id_fkey FOREIGN KEY (purchase_order_id) REFERENCES public.purchase_orders(id)
);
CREATE TABLE public.purchase_order_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  purchase_order_id uuid NOT NULL,
  product_id uuid NOT NULL,
  product_name text NOT NULL,
  product_sku text NOT NULL,
  quantity integer NOT NULL CHECK (quantity > 0),
  received_quantity integer DEFAULT 0 CHECK (received_quantity >= 0),
  pending_quantity integer DEFAULT (quantity - received_quantity),
  unit_cost numeric NOT NULL CHECK (unit_cost >= 0::numeric),
  total_cost numeric DEFAULT ((quantity)::numeric * unit_cost),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT purchase_order_items_pkey PRIMARY KEY (id),
  CONSTRAINT purchase_order_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT purchase_order_items_purchase_order_id_fkey FOREIGN KEY (purchase_order_id) REFERENCES public.purchase_orders(id),
  CONSTRAINT purchase_order_items_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.purchase_order_receiving_records (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  purchase_order_id uuid NOT NULL,
  received_by uuid NOT NULL,
  received_by_name text,
  received_date timestamp with time zone NOT NULL DEFAULT now(),
  notes text,
  status text DEFAULT 'completed'::text CHECK (status = ANY (ARRAY['pending'::text, 'completed'::text, 'cancelled'::text])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT purchase_order_receiving_records_pkey PRIMARY KEY (id),
  CONSTRAINT purchase_order_receiving_records_purchase_order_id_fkey FOREIGN KEY (purchase_order_id) REFERENCES public.purchase_orders(id),
  CONSTRAINT purchase_order_receiving_records_received_by_fkey FOREIGN KEY (received_by) REFERENCES auth.users(id)
);
CREATE TABLE public.purchase_orders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  po_number character varying NOT NULL UNIQUE,
  supplier_id uuid NOT NULL,
  supplier_name character varying NOT NULL,
  items jsonb NOT NULL DEFAULT '[]'::jsonb,
  subtotal numeric NOT NULL DEFAULT 0,
  tax numeric NOT NULL DEFAULT 0,
  total numeric NOT NULL DEFAULT 0,
  status character varying NOT NULL DEFAULT 'draft'::character varying,
  expected_date timestamp with time zone,
  received_date timestamp with time zone,
  created_by uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  enhanced_status text DEFAULT 'draft'::text,
  approval_required boolean DEFAULT false,
  approved_by uuid,
  approved_at timestamp with time zone,
  CONSTRAINT purchase_orders_pkey PRIMARY KEY (id),
  CONSTRAINT purchase_orders_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT purchase_orders_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES auth.users(id),
  CONSTRAINT purchase_orders_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id)
);
CREATE TABLE public.sales (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  invoice_number character varying NOT NULL UNIQUE,
  customer_id uuid,
  customer_name character varying,
  items jsonb NOT NULL DEFAULT '[]'::jsonb,
  subtotal numeric NOT NULL DEFAULT 0,
  tax numeric NOT NULL DEFAULT 0,
  discount numeric NOT NULL DEFAULT 0,
  total numeric NOT NULL DEFAULT 0,
  payment_method character varying NOT NULL DEFAULT 'cash'::character varying,
  payment_status character varying NOT NULL DEFAULT 'pending'::character varying,
  status character varying NOT NULL DEFAULT 'draft'::character varying,
  cashier_id uuid NOT NULL,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT sales_pkey PRIMARY KEY (id),
  CONSTRAINT sales_cashier_id_fkey FOREIGN KEY (cashier_id) REFERENCES public.users(id),
  CONSTRAINT sales_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id)
);
CREATE TABLE public.stock_movements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  change integer NOT NULL,
  type character varying NOT NULL,
  reference_id uuid,
  user_id uuid,
  reason text,
  resulting_stock integer NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT stock_movements_pkey PRIMARY KEY (id),
  CONSTRAINT stock_movements_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT stock_movements_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.suppliers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  contact_person character varying,
  email character varying,
  phone character varying,
  address text,
  city character varying,
  province character varying,
  zip_code character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT suppliers_pkey PRIMARY KEY (id)
);
CREATE TABLE public.time_records (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  employee_id uuid NOT NULL,
  date timestamp with time zone NOT NULL,
  time_in timestamp with time zone NOT NULL,
  time_out timestamp with time zone,
  break_start timestamp with time zone,
  break_end timestamp with time zone,
  total_hours numeric NOT NULL DEFAULT 0,
  overtime_hours numeric NOT NULL DEFAULT 0,
  status character varying NOT NULL DEFAULT 'Present'::character varying,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT time_records_pkey PRIMARY KEY (id),
  CONSTRAINT time_records_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.employees(id)
);
CREATE TABLE public.user_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL UNIQUE,
  theme character varying DEFAULT 'system'::character varying,
  display jsonb DEFAULT '{"topBar": {"showSearch": true, "showThemeToggle": true, "showUserProfile": true, "showMobileSearch": true, "showNotifications": true, "showDatabaseStatus": true, "showSupabaseStatus": true}}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  currency character varying DEFAULT 'PHP'::character varying,
  language character varying DEFAULT 'en'::character varying,
  timezone character varying DEFAULT 'Asia/Manila'::character varying,
  date_format character varying DEFAULT 'MM/dd/yyyy'::character varying,
  time_format character varying DEFAULT '12h'::character varying CHECK (time_format::text = ANY (ARRAY['12h'::character varying, '24h'::character varying]::text[])),
  notifications boolean DEFAULT true,
  inventory boolean DEFAULT true,
  pos boolean DEFAULT true,
  purchases boolean DEFAULT true,
  suppliers boolean DEFAULT true,
  expenses boolean DEFAULT true,
  payroll boolean DEFAULT true,
  accounting boolean DEFAULT true,
  bir boolean DEFAULT true,
  branches boolean DEFAULT true,
  admin_dashboard boolean DEFAULT true,
  privacy jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT user_settings_pkey PRIMARY KEY (id),
  CONSTRAINT user_settings_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email character varying NOT NULL UNIQUE,
  first_name character varying NOT NULL,
  last_name character varying NOT NULL,
  role character varying NOT NULL DEFAULT 'user'::character varying,
  department character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'suspended'::character varying]::text[])),
  full_name character varying,
  last_sign_in_at timestamp with time zone,
  CONSTRAINT users_pkey PRIMARY KEY (id)
);