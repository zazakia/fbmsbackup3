# FBMS Backup & Recovery Guide

**Filipino Business Management System - Project Protection & Backup**

---

## ğŸ›¡ï¸ Quick Start (One Command)

```bash
# Create comprehensive backup with protection
./scripts/backup-and-protect.sh
```

**That's it!** This single command will:
- âœ… Create timestamped project backup
- âœ… Protect critical files from accidental changes
- âœ… Generate integrity checksums
- âœ… Create Git repository bundle
- âœ… Generate recovery scripts

---

## ğŸ“‹ What Gets Backed Up

### **Included in Backup:**
- âœ… All source code (`src/`)
- âœ… Configuration files (`package.json`, `vite.config.ts`, etc.)
- âœ… Documentation (`Docu/`)
- âœ… Database scripts (`database-files/`)
- âœ… Build scripts (`scripts/`)
- âœ… Environment configurations
- âœ… Git history (separate bundle)

### **Excluded from Backup:**
- âŒ `node_modules/` (can be restored with `npm install`)
- âŒ `dist/` (generated by build process)
- âŒ `.git/` (separate Git bundle created)
- âŒ Log files (`*.log`)
- âŒ Temporary files

---

## ğŸ—‚ï¸ Backup Structure

```
/home/b/Documents/cursor/FBMS_BACKUPS/
â”œâ”€â”€ FBMS_backup_20250704_202110.tar.gz      # Project files
â”œâ”€â”€ git_backup_20250704_202110.bundle       # Git repository
â”œâ”€â”€ checksums_20250704_202110.txt           # File integrity
â”œâ”€â”€ restore_20250704_202110.sh              # Recovery script
â””â”€â”€ [older backups...]                      # Automatic cleanup (keeps 10)
```

---

## ğŸ”§ Running Backups

### **Manual Backup**
```bash
# From project root directory
./scripts/backup-and-protect.sh
```

### **Scheduled Backups (Recommended)**

#### **Daily Backup (Crontab)**
```bash
# Edit crontab
crontab -e

# Add this line for daily backup at 2 AM
0 2 * * * cd /home/b/Documents/cursor/FBMS && ./scripts/backup-and-protect.sh
```

#### **Weekly Backup**
```bash
# Weekly backup every Sunday at 3 AM
0 3 * * 0 cd /home/b/Documents/cursor/FBMS && ./scripts/backup-and-protect.sh
```

#### **Before Major Changes**
```bash
# Always backup before major updates
./scripts/backup-and-protect.sh
git checkout -b new-feature
# Make your changes...
```

---

## ğŸ“¦ Backup Script Features

### **1. File Protection**
```bash
# Critical files become read-only
chmod 444 CHAT_SESSION.md
chmod 444 package.json
chmod 444 *.config.js
chmod 400 .env*  # Environment files (owner-only)
```

### **2. Integrity Verification**
```bash
# SHA256 checksums for all important files
find . -type f \( -name "*.ts" -o -name "*.tsx" -o -name "*.js" \) \
  -exec sha256sum {} \;
```

### **3. Automatic Cleanup**
- Keeps only the 10 most recent backups
- Automatically removes old backup files
- Prevents disk space issues

### **4. Git Repository Backup**
```bash
# Complete Git history in portable bundle
git bundle create git_backup_TIMESTAMP.bundle --all
```

---

## ğŸ”„ Recovery & Restoration

### **Quick Recovery**
```bash
# Navigate to backup directory
cd /home/b/Documents/cursor/FBMS_BACKUPS/

# Run the generated recovery script
./restore_20250704_202110.sh FBMS_backup_20250704_202110.tar.gz /path/to/restore/
```

### **Manual Recovery Steps**

#### **1. Restore Project Files**
```bash
# Create restore directory
mkdir -p /path/to/restore/FBMS

# Extract backup
tar -xzf FBMS_backup_20250704_202110.tar.gz -C /path/to/restore/

# Navigate to restored project
cd /path/to/restore/FBMS
```

#### **2. Restore Git Repository**
```bash
# Clone from Git bundle
git clone git_backup_20250704_202110.bundle restored-fbms

# Or add as remote to existing repo
git remote add backup git_backup_20250704_202110.bundle
git fetch backup
```

#### **3. Restore Dependencies**
```bash
# Install dependencies
npm install

# Build project
npm run build

# Run tests
npm run test
```

#### **4. Verify Integrity**
```bash
# Check file integrity with saved checksums
cd /path/to/restore/FBMS
sha256sum -c /home/b/Documents/cursor/FBMS_BACKUPS/checksums_20250704_202110.txt
```

---

## ğŸš¨ Emergency Recovery Scenarios

### **Scenario 1: Accidental File Deletion**
```bash
# Find latest backup
ls -lt /home/b/Documents/cursor/FBMS_BACKUPS/FBMS_backup_*.tar.gz | head -1

# Quick restore specific files
tar -xzf FBMS_backup_LATEST.tar.gz --strip-components=1 -C . "FBMS/src/specific-file.ts"
```

### **Scenario 2: Git Repository Corruption**
```bash
# Backup current work
cp -r project-directory project-backup

# Restore from Git bundle
git clone git_backup_LATEST.bundle recovered-repo

# Merge current work
cd recovered-repo
# Manual merge of changes from project-backup
```

### **Scenario 3: Complete System Failure**
```bash
# On new system, restore everything
mkdir -p ~/restored-fbms
cd ~/restored-fbms

# Extract full backup
tar -xzf FBMS_backup_LATEST.tar.gz

# Restore Git history
git clone git_backup_LATEST.bundle .git-restored
cd .git-restored
git remote set-url origin YOUR_GITHUB_URL

# Install and build
npm install
npm run build
```

---

## ğŸ”§ Customizing Backup Script

### **Change Backup Location**
```bash
# Edit backup-and-protect.sh
PROJECT_DIR="/your/project/path"
BACKUP_DIR="/your/backup/location"
```

### **Exclude Additional Files**
```bash
# Add to tar exclude options
tar -czf "$BACKUP_NAME.tar.gz" \
  --exclude="node_modules" \
  --exclude="dist" \
  --exclude="*.log" \
  --exclude="your-custom-exclusion" \
  # ... rest of command
```

### **Change Retention Policy**
```bash
# Keep more/fewer backups (default: 10)
ls -1t FBMS_backup_*.tar.gz | tail -n +11 | xargs rm -f  # Keep 10
ls -1t FBMS_backup_*.tar.gz | tail -n +21 | xargs rm -f  # Keep 20
```

---

## ğŸ“Š Backup Monitoring

### **Check Backup Status**
```bash
# List all backups
ls -la /home/b/Documents/cursor/FBMS_BACKUPS/

# Check backup sizes
du -h /home/b/Documents/cursor/FBMS_BACKUPS/FBMS_backup_*.tar.gz

# Verify latest backup
tar -tzf FBMS_backup_LATEST.tar.gz | head -20
```

### **Backup Validation**
```bash
# Test backup integrity
tar -tzf FBMS_backup_LATEST.tar.gz > /dev/null && echo "âœ… Backup OK" || echo "âŒ Backup corrupted"

# Verify checksums
sha256sum -c checksums_LATEST.txt
```

---

## ğŸŒ Cross-Platform Compatibility

### **Ubuntu/Linux**
```bash
# All commands work as-is
./scripts/backup-and-protect.sh
```

### **macOS**
```bash
# May need to install GNU tar
brew install gnu-tar
# Then use 'gtar' instead of 'tar' in script
```

### **Windows (WSL)**
```bash
# Works in Windows Subsystem for Linux
# Backup location: /mnt/c/FBMS_Backups/
```

---

## ğŸ” Security Considerations

### **File Permissions**
- âœ… Backup directory: `755` (readable by owner)
- âœ… Backup files: `644` (readable by owner and group)
- âœ… Environment files: `400` (owner-only)

### **Sensitive Data Protection**
```bash
# Exclude sensitive files from backup
--exclude="*.env.production"
--exclude="secrets.json"
--exclude="*.key"
--exclude="*.pem"
```

### **Encryption (Optional)**
```bash
# Encrypt backup with GPG
gpg --symmetric --cipher-algo AES256 FBMS_backup_LATEST.tar.gz

# Decrypt when needed
gpg --decrypt FBMS_backup_LATEST.tar.gz.gpg > FBMS_backup_LATEST.tar.gz
```

---

## âš¡ Backup Best Practices

### **Frequency**
- ğŸ“… **Daily**: Automated scheduled backups
- ğŸš€ **Before deployments**: Manual backup before major releases
- ğŸ”§ **Before major changes**: Backup before feature development
- ğŸ› ï¸ **Before updates**: Backup before dependency updates

### **Testing**
- ğŸ§ª **Monthly**: Test restore process on different machine
- âœ… **Quarterly**: Full disaster recovery simulation
- ğŸ” **Always**: Verify checksums after backup creation

### **Storage**
- ğŸ’¾ **Local**: Fast access for quick recovery
- â˜ï¸ **Cloud**: Upload to Google Drive/Dropbox for offsite backup
- ğŸ“± **Multiple locations**: Keep backups in 2-3 different locations

---

## ğŸ› Troubleshooting

### **Common Issues**

#### **Permission Denied**
```bash
# Make script executable
chmod +x scripts/backup-and-protect.sh

# Fix directory permissions
chmod 755 /home/b/Documents/cursor/FBMS_BACKUPS/
```

#### **Disk Space Issues**
```bash
# Check available space
df -h

# Clean old backups manually
cd /home/b/Documents/cursor/FBMS_BACKUPS/
rm FBMS_backup_OLD_DATE_*.tar.gz
```

#### **Backup Corruption**
```bash
# Test backup integrity
tar -tzf backup.tar.gz

# If corrupted, use previous backup
ls -lt FBMS_backup_*.tar.gz | head -2
```

#### **Git Bundle Issues**
```bash
# Verify Git bundle
git bundle verify git_backup_LATEST.bundle

# List bundle contents
git bundle list-heads git_backup_LATEST.bundle
```

---

## ğŸ“‹ Backup Checklist

Before important work:
- [ ] âœ… Run backup script
- [ ] âœ… Verify backup creation
- [ ] âœ… Check file permissions
- [ ] âœ… Test quick file extraction
- [ ] âœ… Confirm Git bundle creation
- [ ] âœ… Validate checksums

---

## ğŸ¯ Recovery Testing

### **Monthly Recovery Test**
```bash
# 1. Create test backup
./scripts/backup-and-protect.sh

# 2. Restore to temporary location
mkdir -p /tmp/fbms-test-restore
./restore_LATEST.sh FBMS_backup_LATEST.tar.gz /tmp/fbms-test-restore

# 3. Verify restoration
cd /tmp/fbms-test-restore/FBMS
npm install
npm run build
npm run test

# 4. Clean up
rm -rf /tmp/fbms-test-restore
```

---

## ğŸš€ Advanced Features

### **Automated Cloud Upload**
```bash
# Add to backup script for cloud storage
# Example: Google Drive upload
gdrive upload FBMS_backup_${TIMESTAMP}.tar.gz

# Example: AWS S3 upload
aws s3 cp FBMS_backup_${TIMESTAMP}.tar.gz s3://your-backup-bucket/
```

### **Backup Notifications**
```bash
# Email notification on backup completion
echo "FBMS backup completed at $(date)" | mail -s "Backup Complete" your@email.com

# Slack notification
curl -X POST -H 'Content-type: application/json' \
  --data '{"text":"FBMS backup completed successfully"}' \
  YOUR_SLACK_WEBHOOK_URL
```

---

## ğŸ“ Need Help?

- **Script Issues**: Check `/home/b/Documents/cursor/FBMS/scripts/backup-and-protect.sh`
- **Recovery Problems**: Use manual recovery steps in this guide
- **Automation**: Set up cron jobs for scheduled backups
- **Advanced Features**: Customize script for your specific needs

---

## ğŸ“ˆ Backup Statistics

**Typical Backup Sizes:**
- Project files: ~50-100 MB (compressed)
- Git bundle: ~10-50 MB
- Checksums: ~1 MB
- Total backup: ~100-200 MB

**Backup Times:**
- Project backup: ~30 seconds
- Git bundle: ~10 seconds
- Checksum generation: ~20 seconds
- **Total time: ~1 minute**

---

*Last Updated: July 4, 2025*  
*Project: Filipino Business Management System (FBMS)*  
*Script Location: `/scripts/backup-and-protect.sh`*